<?php
/*
  statistiques.php
  
  ENTREE
      mode: type de statistiques: liste-negatif, etat, ventes
      si mode = ventes
          deb: date de debut (timestamp)
	  fin: date de fin (timestamp)
  SORTIE
      liste contenant 
      si liste-negatif: liste[carte, nom, prenom, solde]
      si etat: total-positif, total-negatif, total
      si ventes: liste[article, vente, gain], total
  AUTORISATION:
      bde
*/
$autorise = array("zz", "bde");
function statistiques($settings, $objets){
  if(!isset($objets['user_info']['autorisations']['bde'])return array("error" => 1, "error_msg" => "Accès refusé");
  else
    {
      $bdd=$objets['bdd'];
      if($settings['mode']=='liste-negatif')
	{
	  $liste_negatif = $bdd->query("SELECT numero, nom, prenom, surnom, solde FROM membres WHERE solde<0");
	  $reponse = array("error"=>0);
	  $retour["nb_elt"]=0;
	  foreach($liste_negatif as $neg)
	    {
	      $retour['liste'][] = array(
					 "numero" => $neg['id'],
					 "nom" => utf8_encode($neg['nom']),
					 "prenom" => utf8_encode($neg['prenom']),
					 "surnom" => utf8_encode($neg['surnom']),
					 "solde" => $neg['solde']
					 );
	      $retour['nb_elt']++;
	    }
	}
    }


}


